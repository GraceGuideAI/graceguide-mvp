(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function o(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(t){if(t.ep)return;t.ep=!0;const n=o(t);fetch(t.href,n)}})();const h=document.getElementById("ask"),y=document.getElementById("askLabel"),g=document.getElementById("spinner"),v=document.getElementById("question"),p=document.getElementById("sourceSlider"),L=document.getElementById("answerCard"),T=document.getElementById("output"),E=document.getElementById("sourceList"),b=document.getElementById("historyList"),w=document.querySelectorAll("#historyToggle"),r=document.getElementById("history"),l=document.getElementById("qaContainer"),H=document.getElementById("themeToggle"),B=document.documentElement;localStorage.theme==="dark"&&B.classList.add("dark");H.addEventListener("click",()=>{const e=B.classList.toggle("dark");localStorage.theme=e?"dark":"light"});const k=document.getElementById("emailModal"),u=document.getElementById("joinNow"),I=document.getElementById("joinLabel"),S=document.getElementById("joinSpinner"),M=document.getElementById("maybeLater"),j=document.getElementById("emailInput"),P=document.getElementById("consentCheckbox");let C="both";p.addEventListener("input",()=>{const e=parseInt(p.value,10);C=e===0?"both":e===1?"bible":"catechism"});let c=parseInt(localStorage.getItem("askCount")||"0",10);c<7&&sessionStorage.removeItem("modalShown");function J(){k.classList.remove("hidden")}function x(){k.classList.add("hidden")}function q(){const e=JSON.parse(localStorage.getItem("qaHistory")||"[]");b.innerHTML="",e.forEach(({q:s,a:o})=>{const i=document.createElement("li");i.className="history-item";const t=document.createElement("details"),n=document.createElement("summary");n.textContent=s;const a=document.createElement("div");a.className="qa";const d=document.createElement("p");d.className="text-sm",d.innerHTML=`<span class="font-semibold">Question:</span> ${s}`;const m=document.createElement("p");m.className="mt-2 text-sm",m.innerHTML=`<span class="font-semibold">Answer:</span> ${o}`,a.appendChild(d),a.appendChild(m),t.appendChild(n),t.appendChild(a),i.appendChild(t),b.appendChild(i)})}q();async function N(){const e=v.value.trim();if(e){h.disabled=!0,y.classList.add("hidden"),g.classList.remove("hidden"),L.classList.add("hidden");try{const s=await fetch("/qa",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:e,mode:C})});if(!s.ok)throw new Error(await s.text());const{answer:o,sources:i}=await s.json();T.textContent=o.trim(),E.innerHTML="",i.forEach(n=>{const a=document.createElement("li");a.textContent=n,E.appendChild(a)}),L.classList.remove("hidden");const t=JSON.parse(localStorage.getItem("qaHistory")||"[]");t.unshift({q:e,a:o.trim()}),t.splice(10),localStorage.setItem("qaHistory",JSON.stringify(t)),q(),c+=1,localStorage.setItem("askCount",c),c===7&&!sessionStorage.getItem("modalShown")&&(sessionStorage.setItem("modalShown","true"),J())}catch(s){alert("Error: "+s.message)}finally{g.classList.add("hidden"),y.classList.remove("hidden"),h.disabled=!1}}}h.addEventListener("click",N);v.addEventListener("keydown",e=>{e.key==="Enter"&&(e.metaKey||e.ctrlKey)&&N()});u.addEventListener("click",async()=>{const e=j.value.trim().toLowerCase();if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)||!P.checked){alert("Please provide a valid email and consent.");return}u.disabled=!0,I.classList.add("hidden"),S.classList.remove("hidden");try{const o=await fetch("/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(!o.ok)throw new Error(await o.text());localStorage.setItem("subscribed","true"),alert("Thanks for subscribing!"),x()}catch(o){console.error("Subscription failed",o),alert("Subscription failed: "+o.message)}finally{S.classList.add("hidden"),I.classList.remove("hidden"),u.disabled=!1}});M.addEventListener("click",x);const f=window.matchMedia("(min-width: 1024px)");function A(){r.classList.remove("-translate-x-full"),f.matches&&l.classList.add("ml-72")}function O(){r.classList.add("-translate-x-full"),l.classList.remove("ml-72")}f.addEventListener("change",()=>{f.matches?r.classList.contains("-translate-x-full")||l.classList.add("ml-72"):l.classList.remove("ml-72")});function K(e){!r.contains(e.target)&&![...w].some(s=>s.contains(e.target))&&O()}document.addEventListener("click",K);w.forEach(e=>{e.addEventListener("click",()=>{r.classList.contains("-translate-x-full")?A():O()})});

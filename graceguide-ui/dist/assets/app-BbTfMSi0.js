(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function r(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(e){if(e.ep)return;e.ep=!0;const o=r(e);fetch(e.href,o)}})();const c=document.getElementById("ask"),d=document.getElementById("askLabel"),l=document.getElementById("spinner"),h=document.getElementById("question"),m=document.getElementById("sourceSlider"),u=document.getElementById("answerCard"),S=document.getElementById("output"),y=document.getElementById("sourceList"),f=document.getElementById("historyList"),p=document.getElementById("emailModal"),b=document.getElementById("joinNow"),w=document.getElementById("maybeLater"),B=document.getElementById("emailInput"),v=document.getElementById("consentCheckbox");let g="both";m.addEventListener("input",()=>{const t=parseInt(m.value,10);g=t===0?"both":t===1?"bible":"catechism"});let a=parseInt(localStorage.getItem("askCount")||"0",10);a<7&&sessionStorage.removeItem("modalShown");function C(){p.classList.remove("hidden")}function E(){p.classList.add("hidden")}function L(){const t=JSON.parse(localStorage.getItem("qaHistory")||"[]");f.innerHTML="",t.forEach(({q:n,a:r})=>{const s=document.createElement("li"),e=document.createElement("p");e.className="font-semibold",e.textContent=n;const o=document.createElement("p");o.textContent=r,s.appendChild(e),s.appendChild(o),f.appendChild(s)})}L();async function I(){const t=h.value.trim();if(t){c.disabled=!0,d.classList.add("hidden"),l.classList.remove("hidden"),u.classList.add("hidden");try{const n=await fetch("/qa",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:t,mode:g})});if(!n.ok)throw new Error(await n.text());const{answer:r,sources:s}=await n.json();S.textContent=r.trim(),y.innerHTML="",s.forEach(o=>{const i=document.createElement("li");i.textContent=o,y.appendChild(i)}),u.classList.remove("hidden");const e=JSON.parse(localStorage.getItem("qaHistory")||"[]");e.unshift({q:t,a:r.trim()}),e.splice(10),localStorage.setItem("qaHistory",JSON.stringify(e)),L(),a+=1,localStorage.setItem("askCount",a),a===7&&!sessionStorage.getItem("modalShown")&&(sessionStorage.setItem("modalShown","true"),C())}catch(n){alert("Error: "+n.message)}finally{l.classList.add("hidden"),d.classList.remove("hidden"),c.disabled=!1}}}c.addEventListener("click",I);h.addEventListener("keydown",t=>{t.key==="Enter"&&(t.metaKey||t.ctrlKey)&&I()});b.addEventListener("click",async()=>{const t=B.value.trim();if(!t||!v.checked){alert("Please provide an email and consent.");return}try{const n=await fetch("/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})});if(!n.ok)throw new Error(await n.text());E()}catch(n){alert("Subscription failed: "+n.message)}});w.addEventListener("click",E);

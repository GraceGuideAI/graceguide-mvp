(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function a(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(e){if(e.ep)return;e.ep=!0;const s=a(e);fetch(e.href,s)}})();const d=document.getElementById("ask"),u=document.getElementById("askLabel"),y=document.getElementById("spinner"),L=document.getElementById("question"),f=document.getElementById("sourceSlider"),h=document.getElementById("answerCard"),C=document.getElementById("output"),g=document.getElementById("sourceList"),p=document.getElementById("historyList"),E=document.querySelectorAll("#historyToggle"),r=document.getElementById("history"),l=document.getElementById("qaContainer"),I=document.getElementById("emailModal"),k=document.getElementById("joinNow"),x=document.getElementById("maybeLater"),O=document.getElementById("emailInput"),q=document.getElementById("consentCheckbox");let S="both";f.addEventListener("input",()=>{const t=parseInt(f.value,10);S=t===0?"both":t===1?"bible":"catechism"});let c=parseInt(localStorage.getItem("askCount")||"0",10);c<7&&sessionStorage.removeItem("modalShown");function N(){I.classList.remove("hidden")}function v(){I.classList.add("hidden")}function w(){const t=JSON.parse(localStorage.getItem("qaHistory")||"[]");p.innerHTML="",t.forEach(({q:n,a})=>{const i=document.createElement("li");i.className="history-item";const e=document.createElement("details"),s=document.createElement("summary");s.textContent=n;const o=document.createElement("p");o.className="mt-2",o.textContent=a,e.appendChild(s),e.appendChild(o),i.appendChild(e),p.appendChild(i)})}w();async function b(){const t=L.value.trim();if(t){d.disabled=!0,u.classList.add("hidden"),y.classList.remove("hidden"),h.classList.add("hidden");try{const n=await fetch("/qa",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:t,mode:S})});if(!n.ok)throw new Error(await n.text());const{answer:a,sources:i}=await n.json();C.textContent=a.trim(),g.innerHTML="",i.forEach(s=>{const o=document.createElement("li");o.textContent=s,g.appendChild(o)}),h.classList.remove("hidden");const e=JSON.parse(localStorage.getItem("qaHistory")||"[]");e.unshift({q:t,a:a.trim()}),e.splice(10),localStorage.setItem("qaHistory",JSON.stringify(e)),w(),c+=1,localStorage.setItem("askCount",c),c===7&&!sessionStorage.getItem("modalShown")&&(sessionStorage.setItem("modalShown","true"),N())}catch(n){alert("Error: "+n.message)}finally{y.classList.add("hidden"),u.classList.remove("hidden"),d.disabled=!1}}}d.addEventListener("click",b);L.addEventListener("keydown",t=>{t.key==="Enter"&&(t.metaKey||t.ctrlKey)&&b()});k.addEventListener("click",async()=>{const t=O.value.trim();if(!t||!q.checked){alert("Please provide an email and consent.");return}try{const n=await fetch("/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})});if(!n.ok)throw new Error(await n.text());v()}catch(n){alert("Subscription failed: "+n.message)}});x.addEventListener("click",v);const m=window.matchMedia("(min-width: 1024px)");function H(){r.classList.remove("-translate-x-full"),m.matches&&l.classList.add("ml-72")}function B(){r.classList.add("-translate-x-full"),l.classList.remove("ml-72")}m.addEventListener("change",()=>{m.matches?r.classList.contains("-translate-x-full")||l.classList.add("ml-72"):l.classList.remove("ml-72")});function M(t){!r.contains(t.target)&&![...E].some(n=>n.contains(t.target))&&B()}document.addEventListener("click",M);E.forEach(t=>{t.addEventListener("click",()=>{r.classList.contains("-translate-x-full")?H():B()})});

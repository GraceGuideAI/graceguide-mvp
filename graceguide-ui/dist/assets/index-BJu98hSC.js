(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const r of t.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function s(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function i(e){if(e.ep)return;e.ep=!0;const t=s(e);fetch(e.href,t)}})();const c=document.getElementById("ask"),d=document.getElementById("askLabel"),l=document.getElementById("spinner"),y=document.getElementById("question"),m=document.getElementById("sourceToggle"),u=document.getElementById("answerCard"),E=document.getElementById("output"),f=document.getElementById("sourceList"),h=document.getElementById("emailModal"),L=document.getElementById("joinNow"),I=document.getElementById("maybeLater"),b=document.getElementById("emailInput"),w=document.getElementById("consentCheckbox");let a=parseInt(localStorage.getItem("askCount")||"0",10);a<7&&sessionStorage.removeItem("modalShown");function B(){h.classList.remove("hidden")}function g(){h.classList.add("hidden")}async function p(){const n=y.value.trim();if(!n)return;c.disabled=!0,d.classList.add("hidden"),l.classList.remove("hidden"),u.classList.add("hidden");const o=m.value==="0"?"bible":m.value==="2"?"catechism":"both";try{const s=await fetch("/qa",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:n,mode:o})});if(!s.ok)throw new Error(await s.text());const{answer:i,sources:e}=await s.json();E.textContent=i.trim(),f.innerHTML="",e.forEach(t=>{const r=document.createElement("li");r.textContent=t,f.appendChild(r)}),u.classList.remove("hidden"),a+=1,localStorage.setItem("askCount",a),a===7&&!sessionStorage.getItem("modalShown")&&(sessionStorage.setItem("modalShown","true"),B())}catch(s){alert("Error: "+s.message)}finally{l.classList.add("hidden"),d.classList.remove("hidden"),c.disabled=!1}}c.addEventListener("click",p);y.addEventListener("keydown",n=>{n.key==="Enter"&&(n.metaKey||n.ctrlKey)&&p()});L.addEventListener("click",async()=>{const n=b.value.trim();if(!n||!w.checked){alert("Please provide an email and consent.");return}try{const o=await fetch("/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n})});if(!o.ok)throw new Error(await o.text());g()}catch(o){alert("Subscription failed: "+o.message)}});I.addEventListener("click",g);

(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function i(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(t){if(t.ep)return;t.ep=!0;const s=i(t);fetch(t.href,s)}})();const d=document.getElementById("ask"),u=document.getElementById("askLabel"),h=document.getElementById("spinner"),L=document.getElementById("question"),y=document.getElementById("sourceSlider"),f=document.getElementById("answerCard"),C=document.getElementById("output"),g=document.getElementById("sourceList"),p=document.getElementById("historyList"),E=document.querySelectorAll("#historyToggle"),r=document.getElementById("history"),l=document.getElementById("qaContainer"),x=document.getElementById("themeToggle"),I=document.documentElement;localStorage.theme==="dark"&&I.classList.add("dark");x.addEventListener("click",()=>{const e=I.classList.toggle("dark");localStorage.theme=e?"dark":"light"});const S=document.getElementById("emailModal"),O=document.getElementById("joinNow"),q=document.getElementById("maybeLater"),N=document.getElementById("emailInput"),T=document.getElementById("consentCheckbox");let v="both";y.addEventListener("input",()=>{const e=parseInt(y.value,10);v=e===0?"both":e===1?"bible":"catechism"});let c=parseInt(localStorage.getItem("askCount")||"0",10);c<7&&sessionStorage.removeItem("modalShown");function H(){S.classList.remove("hidden")}function b(){S.classList.add("hidden")}function w(){const e=JSON.parse(localStorage.getItem("qaHistory")||"[]");p.innerHTML="",e.forEach(({q:n,a:i})=>{const a=document.createElement("li");a.className="history-item";const t=document.createElement("details"),s=document.createElement("summary");s.textContent=n;const o=document.createElement("p");o.className="mt-2",o.textContent=i,t.appendChild(s),t.appendChild(o),a.appendChild(t),p.appendChild(a)})}w();async function k(){const e=L.value.trim();if(e){d.disabled=!0,u.classList.add("hidden"),h.classList.remove("hidden"),f.classList.add("hidden");try{const n=await fetch("/qa",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:e,mode:v})});if(!n.ok)throw new Error(await n.text());const{answer:i,sources:a}=await n.json();C.textContent=i.trim(),g.innerHTML="",a.forEach(s=>{const o=document.createElement("li");o.textContent=s,g.appendChild(o)}),f.classList.remove("hidden");const t=JSON.parse(localStorage.getItem("qaHistory")||"[]");t.unshift({q:e,a:i.trim()}),t.splice(10),localStorage.setItem("qaHistory",JSON.stringify(t)),w(),c+=1,localStorage.setItem("askCount",c),c===7&&!sessionStorage.getItem("modalShown")&&(sessionStorage.setItem("modalShown","true"),H())}catch(n){alert("Error: "+n.message)}finally{h.classList.add("hidden"),u.classList.remove("hidden"),d.disabled=!1}}}d.addEventListener("click",k);L.addEventListener("keydown",e=>{e.key==="Enter"&&(e.metaKey||e.ctrlKey)&&k()});O.addEventListener("click",async()=>{const e=N.value.trim();if(!e||!T.checked){alert("Please provide an email and consent.");return}try{const n=await fetch("/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(!n.ok)throw new Error(await n.text());b()}catch(n){alert("Subscription failed: "+n.message)}});q.addEventListener("click",b);const m=window.matchMedia("(min-width: 1024px)");function M(){r.classList.remove("-translate-x-full"),m.matches&&l.classList.add("ml-72")}function B(){r.classList.add("-translate-x-full"),l.classList.remove("ml-72")}m.addEventListener("change",()=>{m.matches?r.classList.contains("-translate-x-full")||l.classList.add("ml-72"):l.classList.remove("ml-72")});function P(e){!r.contains(e.target)&&![...E].some(n=>n.contains(e.target))&&B()}document.addEventListener("click",P);E.forEach(e=>{e.addEventListener("click",()=>{r.classList.contains("-translate-x-full")?M():B()})});

(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function r(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(t){if(t.ep)return;t.ep=!0;const s=r(t);fetch(t.href,s)}})();const g=document.getElementById("ask"),y=document.getElementById("askLabel"),f=document.getElementById("spinner"),b=document.getElementById("question"),p=document.getElementById("sourceSlider"),L=document.getElementById("answerCard"),N=document.getElementById("output"),E=document.getElementById("sourceList"),I=document.getElementById("historyList"),S=document.querySelectorAll("#historyToggle"),m=document.getElementById("history"),u=document.getElementById("qaContainer"),O=document.getElementById("themeToggle"),w=document.documentElement;localStorage.theme==="dark"&&w.classList.add("dark");O.addEventListener("click",()=>{const e=w.classList.toggle("dark");localStorage.theme=e?"dark":"light"});const v=document.getElementById("emailModal"),T=document.getElementById("joinNow"),H=document.getElementById("maybeLater"),M=document.getElementById("emailInput"),P=document.getElementById("consentCheckbox");let k="both";p.addEventListener("input",()=>{const e=parseInt(p.value,10);k=e===0?"both":e===1?"bible":"catechism"});let i=parseInt(localStorage.getItem("askCount")||"0",10),d=parseInt(localStorage.getItem("maybeLaterUntil")||"0",10);(i<5||i<d)&&sessionStorage.removeItem("modalShown");function j(){console.log("Showing email modal"),v.classList.remove("hidden")}function B(){console.log("Hiding email modal"),v.classList.add("hidden")}function C(){const e=JSON.parse(localStorage.getItem("qaHistory")||"[]");I.innerHTML="",e.forEach(({q:n,a:r})=>{const a=document.createElement("li");a.className="history-item";const t=document.createElement("details"),s=document.createElement("summary");s.textContent=n;const o=document.createElement("div");o.className="qa";const l=document.createElement("p");l.className="text-sm",l.innerHTML=`<span class="font-semibold">Question:</span> ${n}`;const c=document.createElement("p");c.className="mt-2 text-sm",c.innerHTML=`<span class="font-semibold">Answer:</span> ${r}`,o.appendChild(l),o.appendChild(c),t.appendChild(s),t.appendChild(o),a.appendChild(t),I.appendChild(a)})}C();async function x(){const e=b.value.trim();if(e){g.disabled=!0,y.classList.add("hidden"),f.classList.remove("hidden"),L.classList.add("hidden");try{const n=await fetch("/qa",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:e,mode:k})});if(!n.ok)throw new Error(await n.text());const{answer:r,sources:a}=await n.json();N.textContent=r.trim(),E.innerHTML="",a.forEach(l=>{const c=document.createElement("li");c.textContent=l,E.appendChild(c)}),L.classList.remove("hidden");const t=JSON.parse(localStorage.getItem("qaHistory")||"[]");t.unshift({q:e,a:r.trim()}),t.splice(10),localStorage.setItem("qaHistory",JSON.stringify(t)),C(),i+=1,localStorage.setItem("askCount",i);const s=localStorage.getItem("subscribed");d=parseInt(localStorage.getItem("maybeLaterUntil")||"0",10),!s&&i>=5&&i>=d&&!sessionStorage.getItem("modalShown")&&(sessionStorage.setItem("modalShown","true"),j())}catch(n){alert("Error: "+n.message)}finally{f.classList.add("hidden"),y.classList.remove("hidden"),g.disabled=!1}}}g.addEventListener("click",x);b.addEventListener("keydown",e=>{e.key==="Enter"&&(e.metaKey||e.ctrlKey)&&x()});T.addEventListener("click",async()=>{const e=M.value.trim();if(!e||!P.checked){alert("Please provide an email and consent.");return}try{const n=await fetch("/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(!n.ok)throw new Error(await n.text());localStorage.setItem("subscribed","true"),B()}catch(n){alert("Subscription failed: "+n.message)}});H.addEventListener("click",()=>{d=i+10,localStorage.setItem("maybeLaterUntil",d),B()});const h=window.matchMedia("(min-width: 1024px)");function J(){m.classList.remove("-translate-x-full"),h.matches&&u.classList.add("ml-72")}function q(){m.classList.add("-translate-x-full"),u.classList.remove("ml-72")}h.addEventListener("change",()=>{h.matches?m.classList.contains("-translate-x-full")||u.classList.add("ml-72"):u.classList.remove("ml-72")});function U(e){!m.contains(e.target)&&![...S].some(n=>n.contains(e.target))&&q()}document.addEventListener("click",U);S.forEach(e=>{e.addEventListener("click",()=>{m.classList.contains("-translate-x-full")?J():q()})});

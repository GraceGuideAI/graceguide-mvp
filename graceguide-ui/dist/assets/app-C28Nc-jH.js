(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function i(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(t){if(t.ep)return;t.ep=!0;const o=i(t);fetch(t.href,o)}})();const d=document.getElementById("ask"),u=document.getElementById("askLabel"),y=document.getElementById("spinner"),E=document.getElementById("question"),f=document.getElementById("sourceSlider"),h=document.getElementById("answerCard"),B=document.getElementById("output"),p=document.getElementById("sourceList"),g=document.getElementById("historyList"),L=document.getElementById("historyToggle"),l=document.getElementById("history"),I=document.getElementById("emailModal"),k=document.getElementById("joinNow"),C=document.getElementById("maybeLater"),O=document.getElementById("emailInput"),N=document.getElementById("consentCheckbox");let S="both";f.addEventListener("input",()=>{const e=parseInt(f.value,10);S=e===0?"both":e===1?"bible":"catechism"});let c=parseInt(localStorage.getItem("askCount")||"0",10);c<7&&sessionStorage.removeItem("modalShown");function x(){I.classList.remove("hidden")}function b(){I.classList.add("hidden")}function v(){const e=JSON.parse(localStorage.getItem("qaHistory")||"[]");g.innerHTML="",e.forEach(({q:n,a:i})=>{const r=document.createElement("li");r.className="history-item";const t=document.createElement("details"),o=document.createElement("summary");o.textContent=n;const s=document.createElement("p");s.className="mt-2",s.textContent=i,t.appendChild(o),t.appendChild(s),r.appendChild(t),g.appendChild(r)})}v();async function w(){const e=E.value.trim();if(e){d.disabled=!0,u.classList.add("hidden"),y.classList.remove("hidden"),h.classList.add("hidden");try{const n=await fetch("/qa",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:e,mode:S})});if(!n.ok)throw new Error(await n.text());const{answer:i,sources:r}=await n.json();B.textContent=i.trim(),p.innerHTML="",r.forEach(o=>{const s=document.createElement("li");s.textContent=o,p.appendChild(s)}),h.classList.remove("hidden");const t=JSON.parse(localStorage.getItem("qaHistory")||"[]");t.unshift({q:e,a:i.trim()}),t.splice(10),localStorage.setItem("qaHistory",JSON.stringify(t)),v(),c+=1,localStorage.setItem("askCount",c),c===7&&!sessionStorage.getItem("modalShown")&&(sessionStorage.setItem("modalShown","true"),x())}catch(n){alert("Error: "+n.message)}finally{y.classList.add("hidden"),u.classList.remove("hidden"),d.disabled=!1}}}d.addEventListener("click",w);E.addEventListener("keydown",e=>{e.key==="Enter"&&(e.metaKey||e.ctrlKey)&&w()});k.addEventListener("click",async()=>{const e=O.value.trim();if(!e||!N.checked){alert("Please provide an email and consent.");return}try{const n=await fetch("/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(!n.ok)throw new Error(await n.text());b()}catch(n){alert("Subscription failed: "+n.message)}});C.addEventListener("click",b);let a=!1;function q(){l.classList.remove("-translate-x-full"),a=!0}function m(){l.classList.add("-translate-x-full"),a=!1}L.addEventListener("click",e=>{e.stopPropagation(),a?m():q()});document.addEventListener("click",e=>{a&&!l.contains(e.target)&&e.target!==L&&m()});document.addEventListener("keydown",e=>{a&&e.key==="Escape"&&m()});

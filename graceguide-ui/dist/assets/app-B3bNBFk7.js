(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function i(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(e){if(e.ep)return;e.ep=!0;const o=i(e);fetch(e.href,o)}})();const a=document.getElementById("ask"),l=document.getElementById("askLabel"),m=document.getElementById("spinner"),h=document.getElementById("question"),u=document.querySelectorAll(".src-btn"),f=document.getElementById("answerCard"),E=document.getElementById("output"),y=document.getElementById("sourceList"),p=document.getElementById("emailModal"),I=document.getElementById("joinNow"),v=document.getElementById("maybeLater"),w=document.getElementById("emailInput"),b=document.getElementById("consentCheckbox");u.forEach(t=>{t.addEventListener("click",()=>{u.forEach(n=>n.classList.remove("active")),t.classList.add("active")})});let c=parseInt(localStorage.getItem("askCount")||"0",10);c<7&&sessionStorage.removeItem("modalShown");function B(){p.classList.remove("hidden")}function g(){p.classList.add("hidden")}async function L(){const t=h.value.trim();if(!t)return;a.disabled=!0,l.classList.add("hidden"),m.classList.remove("hidden"),f.classList.add("hidden");const n=document.querySelector(".src-btn.active"),i=n?n.dataset.mode:"both";try{const s=await fetch("/qa",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:t,mode:i})});if(!s.ok)throw new Error(await s.text());const{answer:e,sources:o}=await s.json();E.textContent=e.trim(),y.innerHTML="",o.forEach(r=>{const d=document.createElement("li");d.textContent=r,y.appendChild(d)}),f.classList.remove("hidden"),c+=1,localStorage.setItem("askCount",c),c===7&&!sessionStorage.getItem("modalShown")&&(sessionStorage.setItem("modalShown","true"),B())}catch(s){alert("Error: "+s.message)}finally{m.classList.add("hidden"),l.classList.remove("hidden"),a.disabled=!1}}a.addEventListener("click",L);h.addEventListener("keydown",t=>{t.key==="Enter"&&(t.metaKey||t.ctrlKey)&&L()});I.addEventListener("click",async()=>{const t=w.value.trim();if(!t||!b.checked){alert("Please provide an email and consent.");return}try{const n=await fetch("/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})});if(!n.ok)throw new Error(await n.text());g()}catch(n){alert("Subscription failed: "+n.message)}});v.addEventListener("click",g);

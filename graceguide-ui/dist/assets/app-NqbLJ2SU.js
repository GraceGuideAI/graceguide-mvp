(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function c(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(t){if(t.ep)return;t.ep=!0;const n=c(t);fetch(t.href,n)}})();const p=document.getElementById("ask"),b=document.getElementById("askLabel"),S=document.getElementById("spinner"),q=document.getElementById("question"),v=document.getElementById("sourceSlider"),w=document.getElementById("answerCard"),P=document.getElementById("output"),B=document.getElementById("sourceList"),C=document.getElementById("historyList"),N=document.querySelectorAll("#historyToggle"),y=document.getElementById("history"),h=document.getElementById("qaContainer"),_=document.getElementById("themeToggle"),T=document.documentElement;localStorage.theme==="dark"&&T.classList.add("dark");_.addEventListener("click",()=>{const e=T.classList.toggle("dark");localStorage.theme=e?"dark":"light"});const r=document.getElementById("emailModal"),f=document.getElementById("joinNow"),k=document.getElementById("joinLabel"),O=document.getElementById("joinSpinner"),J=document.getElementById("maybeLater"),L=document.getElementById("emailInput"),A=document.getElementById("closeModal"),g=document.getElementById("modalContent");async function m(e){try{await fetch("/log_event",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event:e})})}catch{}}let x="both";v.addEventListener("input",()=>{const e=parseInt(v.value,10);x=e===0?"both":e===1?"bible":"catechism"});let i=parseInt(localStorage.getItem("askCount")||"0",10),u=parseInt(localStorage.getItem("maybeLaterUntil")||"0",10);(i<5||i<u)&&sessionStorage.removeItem("modalShown");function U(){console.log("Showing email modal"),r.classList.remove("hidden"),r.classList.remove("opacity-0"),g.classList.remove("opacity-0","scale-90"),requestAnimationFrame(()=>{r.classList.add("opacity-100"),g.classList.add("opacity-100","scale-100")}),m("modal_shown"),L.focus()}function I(){r.classList.remove("opacity-100"),r.classList.add("opacity-0"),g.classList.remove("opacity-100","scale-100"),g.classList.add("opacity-0","scale-90"),setTimeout(()=>{r.classList.add("hidden")},300)}function M(){const e=JSON.parse(localStorage.getItem("qaHistory")||"[]");C.innerHTML="",e.forEach(({q:s,a:c})=>{const a=document.createElement("li");a.className="history-item";const t=document.createElement("details"),n=document.createElement("summary");n.textContent=s;const o=document.createElement("div");o.className="qa";const d=document.createElement("p");d.className="text-sm",d.innerHTML=`<span class="font-semibold">Question:</span> ${s}`;const l=document.createElement("p");l.className="mt-2 text-sm",l.innerHTML=`<span class="font-semibold">Answer:</span> ${c}`,o.appendChild(d),o.appendChild(l),t.appendChild(n),t.appendChild(o),a.appendChild(t),C.appendChild(a)})}M();async function j(){const e=q.value.trim();if(e){p.disabled=!0,b.classList.add("hidden"),S.classList.remove("hidden"),w.classList.add("hidden");try{const s=await fetch("/qa",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:e,mode:x})});if(!s.ok)throw new Error(await s.text());const{answer:c,sources:a}=await s.json();P.textContent=c.trim(),B.innerHTML="",a.forEach(d=>{const l=document.createElement("li");l.textContent=d,B.appendChild(l)}),w.classList.remove("hidden");const t=JSON.parse(localStorage.getItem("qaHistory")||"[]");t.unshift({q:e,a:c.trim()}),t.splice(10),localStorage.setItem("qaHistory",JSON.stringify(t)),M(),i+=1,localStorage.setItem("askCount",i);const n=localStorage.getItem("subscribed");u=parseInt(localStorage.getItem("maybeLaterUntil")||"0",10),!n&&i>=5&&i>=u&&!sessionStorage.getItem("modalShown")&&(sessionStorage.setItem("modalShown","true"),U())}catch(s){alert("Error: "+s.message)}finally{S.classList.add("hidden"),b.classList.remove("hidden"),p.disabled=!1}}}p.addEventListener("click",j);q.addEventListener("keydown",e=>{e.key==="Enter"&&(e.metaKey||e.ctrlKey)&&j()});f.addEventListener("click",async()=>{const e=L.value.trim();if(!e){alert("Please enter a valid email address."),L.focus();return}f.disabled=!0,k.classList.add("hidden"),O.classList.remove("hidden");try{const s=await fetch("/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(!s.ok)throw new Error(await s.text());localStorage.setItem("subscribed","true"),I(),m("email_success")}catch(s){console.error("Subscription failed",s),alert("Subscription failed: "+s.message),m("email_failure")}finally{O.classList.add("hidden"),k.classList.remove("hidden"),f.disabled=!1}});J.addEventListener("click",()=>{u=i+10,localStorage.setItem("maybeLaterUntil",u),I(),m("maybe_later")});A.addEventListener("click",()=>{I(),m("modal_close")});const E=window.matchMedia("(min-width: 1024px)");function K(){y.classList.remove("-translate-x-full"),E.matches&&h.classList.add("ml-72")}function H(){y.classList.add("-translate-x-full"),h.classList.remove("ml-72")}E.addEventListener("change",()=>{E.matches?y.classList.contains("-translate-x-full")||h.classList.add("ml-72"):h.classList.remove("ml-72")});function F(e){!y.contains(e.target)&&![...N].some(s=>s.contains(e.target))&&H()}document.addEventListener("click",F);N.forEach(e=>{e.addEventListener("click",()=>{y.classList.contains("-translate-x-full")?K():H()})});

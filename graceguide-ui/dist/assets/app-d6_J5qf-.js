(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function s(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(t){if(t.ep)return;t.ep=!0;const a=s(t);fetch(t.href,a)}})();const I=document.getElementById("ask"),C=document.getElementById("askLabel"),k=document.getElementById("spinner"),j=document.getElementById("question"),x=document.getElementById("sourceSlider"),M=document.getElementById("answerCard"),R=document.getElementById("output"),T=document.getElementById("sourceList"),A=document.getElementById("historyList"),H=document.querySelectorAll("#historyToggle"),g=document.getElementById("history"),y=document.getElementById("qaContainer"),F=document.getElementById("themeToggle"),P=document.documentElement;localStorage.theme==="dark"&&P.classList.add("dark");F.addEventListener("click",()=>{const e=P.classList.toggle("dark");localStorage.theme=e?"dark":"light"});const m=document.getElementById("emailModal"),w=document.getElementById("joinNow"),N=document.getElementById("joinLabel"),q=document.getElementById("joinSpinner"),J=document.getElementById("maybeLater"),b=document.getElementById("emailInput"),D=document.getElementById("closeModal"),f=document.getElementById("modalContent"),u=document.getElementById("shareModal"),L=document.getElementById("shareContent"),K=document.getElementById("sharePreview"),Y=document.getElementById("downloadShare"),W=document.getElementById("tweetShare"),Z=document.getElementById("instaShare"),z=document.getElementById("emailShare"),V=document.getElementById("closeShare"),X=document.getElementById("carYear"),ee=document.getElementById("carMake"),te=document.getElementById("carModel"),ne=document.getElementById("carTrim"),ae=document.getElementById("carColor"),se=document.getElementById("carWheels"),oe=document.getElementById("generateImage"),O=document.getElementById("imageResult");async function h(e){try{await fetch("/log_event",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event:e})})}catch{}}let G="both";x.addEventListener("input",()=>{const e=parseInt(x.value,10);G=e===0?"both":e===1?"bible":"catechism"});let l=parseInt(localStorage.getItem("askCount")||"0",10),p=parseInt(localStorage.getItem("maybeLaterUntil")||"0",10);(l<5||l<p)&&sessionStorage.removeItem("modalShown");function ce(){console.log("Showing email modal"),m.classList.remove("hidden"),m.classList.remove("opacity-0"),f.classList.remove("opacity-0","scale-90"),requestAnimationFrame(()=>{m.classList.add("opacity-100"),f.classList.add("opacity-100","scale-100")}),h("modal_shown"),b.focus()}function B(){m.classList.remove("opacity-100"),m.classList.add("opacity-0"),f.classList.remove("opacity-100","scale-100"),f.classList.add("opacity-0","scale-90"),setTimeout(()=>{m.classList.add("hidden")},300)}function ie(){u.classList.remove("hidden"),u.classList.remove("opacity-0"),L.classList.remove("opacity-0","scale-90"),requestAnimationFrame(()=>{u.classList.add("opacity-100"),L.classList.add("opacity-100","scale-100")})}function re(){u.classList.remove("opacity-100"),u.classList.add("opacity-0"),L.classList.remove("opacity-100","scale-100"),L.classList.add("opacity-0","scale-90"),setTimeout(()=>{u.classList.add("hidden")},300)}function le(e,n){const s=e.split(","),o=s[0].match(/:(.*?);/)[1],t=atob(s[1]);let a=t.length;const c=new Uint8Array(a);for(;a--;)c[a]=t.charCodeAt(a);return new File([c],n,{type:o})}async function de(e,n){const s=document.createElement("div");s.className="share-card bg-white text-gray-800 p-4 rounded-md border w-[350px] md:w-[600px] font-serif space-y-2";const o=document.createElement("div");o.className="bg-brand text-white text-center font-semibold py-2 rounded-md",o.textContent="GraceGuideAI";const t=document.createElement("p");t.innerHTML="<strong>Q:</strong> "+e;const a=document.createElement("p");a.innerHTML="<strong>A:</strong> "+n,s.appendChild(o),s.appendChild(t),s.appendChild(a),document.body.appendChild(s);const c=await html2canvas(s);return s.remove(),c.toDataURL("image/png")}let d;async function me(e,n){const s=await de(e,n);d=le(s,"graceguide.png"),K.src=s,Y.href=s,ie()}function U(){const e=JSON.parse(localStorage.getItem("qaHistory")||"[]");A.innerHTML="",e.forEach(({q:n,a:s})=>{const o=document.createElement("li");o.className="history-item";const t=document.createElement("details"),a=document.createElement("summary");a.className="flex justify-between items-center";const c=document.createElement("span");c.textContent=n;const r=document.createElement("button");r.className="share-btn ml-2 text-brand",r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-4 w-4"><path stroke-linecap="round" stroke-linejoin="round" d="M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z"/></svg>',r.addEventListener("click",$=>{$.stopPropagation(),me(n,s)}),a.appendChild(c),a.appendChild(r);const i=document.createElement("div");i.className="qa";const E=document.createElement("p");E.className="text-sm",E.innerHTML=`<span class="font-semibold">Question:</span> ${n}`;const v=document.createElement("p");v.className="mt-2 text-sm",v.innerHTML=`<span class="font-semibold">Answer:</span> ${s}`,i.appendChild(E),i.appendChild(v),t.appendChild(a),t.appendChild(i),o.appendChild(t),A.appendChild(o)})}U();async function Q(){const e=j.value.trim();if(e){I.disabled=!0,C.classList.add("hidden"),k.classList.remove("hidden"),M.classList.add("hidden");try{const n=await fetch("/qa",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:e,mode:G})});if(!n.ok)throw new Error(await n.text());const{answer:s,sources:o}=await n.json();R.textContent=s.trim(),T.innerHTML="",o.forEach(r=>{const i=document.createElement("li");i.textContent=r,T.appendChild(i)}),M.classList.remove("hidden");const t=JSON.parse(localStorage.getItem("qaHistory")||"[]");t.unshift({q:e,a:s.trim()}),t.splice(10),localStorage.setItem("qaHistory",JSON.stringify(t)),U(),l+=1,localStorage.setItem("askCount",l);const a=localStorage.getItem("subscribed");p=parseInt(localStorage.getItem("maybeLaterUntil")||"0",10),!a&&l>=5&&l>=p&&!sessionStorage.getItem("modalShown")&&(sessionStorage.setItem("modalShown","true"),ce())}catch(n){alert("Error: "+n.message)}finally{k.classList.add("hidden"),C.classList.remove("hidden"),I.disabled=!1}}}I.addEventListener("click",Q);j.addEventListener("keydown",e=>{e.key==="Enter"&&(e.metaKey||e.ctrlKey)&&Q()});w.addEventListener("click",async()=>{const e=b.value.trim();if(!e){alert("Please enter a valid email address."),b.focus();return}w.disabled=!0,N.classList.add("hidden"),q.classList.remove("hidden");try{const n=await fetch("/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(!n.ok)throw new Error(await n.text());localStorage.setItem("subscribed","true"),B(),h("email_success")}catch(n){console.error("Subscription failed",n),alert("Subscription failed: "+n.message),h("email_failure")}finally{q.classList.add("hidden"),N.classList.remove("hidden"),w.disabled=!1}});J.addEventListener("click",()=>{p=l+10,localStorage.setItem("maybeLaterUntil",p),B(),h("maybe_later")});D.addEventListener("click",()=>{B(),h("modal_close")});const S=window.matchMedia("(min-width: 1024px)");function ue(){g.classList.remove("-translate-x-full"),S.matches&&y.classList.add("ml-72")}function _(){g.classList.add("-translate-x-full"),y.classList.remove("ml-72")}S.addEventListener("change",()=>{S.matches?g.classList.contains("-translate-x-full")||y.classList.add("ml-72"):y.classList.remove("ml-72")});function he(e){!g.contains(e.target)&&![...H].some(n=>n.contains(e.target))&&_()}document.addEventListener("click",he);H.forEach(e=>{e.addEventListener("click",()=>{g.classList.contains("-translate-x-full")?ue():_()})});V.addEventListener("click",re);W.addEventListener("click",async()=>{if(navigator.canShare&&navigator.canShare({files:[d]}))await navigator.share({files:[d],text:"GraceGuideAI Q&A"});else{const e="https://twitter.com/intent/tweet?text="+encodeURIComponent("GraceGuideAI Q&A");window.open(e,"_blank")}});Z.addEventListener("click",async()=>{navigator.canShare&&navigator.canShare({files:[d]})?await navigator.share({files:[d],text:"GraceGuideAI Q&A"}):alert("Your browser does not support direct image sharing. Please download the image and share manually.")});z.addEventListener("click",async()=>{navigator.canShare&&navigator.canShare({files:[d]})?await navigator.share({files:[d],title:"GraceGuideAI Q&A"}):window.location.href="mailto:?subject=GraceGuideAI%20Q%26A"});oe.addEventListener("click",()=>{const e=X.value.trim(),n=ee.value.trim(),s=te.value.trim(),o=ne.value.trim(),t=ae.value.trim(),a=se.value.trim(),c=`Render a full side-profile of a ${e} Porsche ${n} ${s} ${o} painted in ${t} with ${a} wheels. Place the car perfectly centered on a pure white background, no text, no logos, no watermarks, no other objects. Apply this visual style: 3-D cute cartoon illustration, isometric yet true side-profile, rounded shapes, thin dark linework, soft pastel base colors with vivid accents, subtle top-left lighting, smooth matte surfaces, playful simplified 3-D vibe`,r="https://image.pollinations.ai/prompt/"+encodeURIComponent(c);O.innerHTML="";const i=document.createElement("img");i.alt="Generated car",i.className="max-w-full",i.src=r,O.appendChild(i)});

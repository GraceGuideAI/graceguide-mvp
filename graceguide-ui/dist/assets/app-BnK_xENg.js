(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function i(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(e){if(e.ep)return;e.ep=!0;const o=i(e);fetch(e.href,o)}})();const d=document.getElementById("ask"),l=document.getElementById("askLabel"),m=document.getElementById("spinner"),g=document.getElementById("question"),u=document.getElementById("sourceSlider"),y=document.getElementById("answerCard"),C=document.getElementById("output"),f=document.getElementById("sourceList"),h=document.getElementById("historyList"),p=document.querySelectorAll("#historyToggle"),c=document.getElementById("history"),E=document.getElementById("qaContainer"),L=document.getElementById("emailModal"),w=document.getElementById("joinNow"),k=document.getElementById("maybeLater"),O=document.getElementById("emailInput"),q=document.getElementById("consentCheckbox");let I="both";u.addEventListener("input",()=>{const t=parseInt(u.value,10);I=t===0?"both":t===1?"bible":"catechism"});let a=parseInt(localStorage.getItem("askCount")||"0",10);a<7&&sessionStorage.removeItem("modalShown");function x(){L.classList.remove("hidden")}function S(){L.classList.add("hidden")}function b(){const t=JSON.parse(localStorage.getItem("qaHistory")||"[]");h.innerHTML="",t.forEach(({q:n,a:i})=>{const r=document.createElement("li");r.className="history-item";const e=document.createElement("details"),o=document.createElement("summary");o.textContent=n;const s=document.createElement("p");s.className="mt-2",s.textContent=i,e.appendChild(o),e.appendChild(s),r.appendChild(e),h.appendChild(r)})}b();async function v(){const t=g.value.trim();if(t){d.disabled=!0,l.classList.add("hidden"),m.classList.remove("hidden"),y.classList.add("hidden");try{const n=await fetch("/qa",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:t,mode:I})});if(!n.ok)throw new Error(await n.text());const{answer:i,sources:r}=await n.json();C.textContent=i.trim(),f.innerHTML="",r.forEach(o=>{const s=document.createElement("li");s.textContent=o,f.appendChild(s)}),y.classList.remove("hidden");const e=JSON.parse(localStorage.getItem("qaHistory")||"[]");e.unshift({q:t,a:i.trim()}),e.splice(10),localStorage.setItem("qaHistory",JSON.stringify(e)),b(),a+=1,localStorage.setItem("askCount",a),a===7&&!sessionStorage.getItem("modalShown")&&(sessionStorage.setItem("modalShown","true"),x())}catch(n){alert("Error: "+n.message)}finally{m.classList.add("hidden"),l.classList.remove("hidden"),d.disabled=!1}}}d.addEventListener("click",v);g.addEventListener("keydown",t=>{t.key==="Enter"&&(t.metaKey||t.ctrlKey)&&v()});w.addEventListener("click",async()=>{const t=O.value.trim();if(!t||!q.checked){alert("Please provide an email and consent.");return}try{const n=await fetch("/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})});if(!n.ok)throw new Error(await n.text());S()}catch(n){alert("Subscription failed: "+n.message)}});k.addEventListener("click",S);function N(){c.classList.remove("-translate-x-full"),E.classList.add("ml-72")}function B(){c.classList.add("-translate-x-full"),E.classList.remove("ml-72")}function H(t){!c.contains(t.target)&&![...p].some(n=>n.contains(t.target))&&B()}document.addEventListener("click",H);p.forEach(t=>{t.addEventListener("click",()=>{c.classList.contains("-translate-x-full")?N():B()})});
